rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    // Helper function to determine if the user is an admin for the condominium
    // TODO: Implement this function based on your role management strategy.
    // Example: return get(/databases/$(database)/documents/condominium_admins/$(condominiumId)).data.adminIds.hasAny([request.auth.uid]);
    function isCondominiumAdmin(condominiumId) {
       return exists(/databases/$(database)/documents/condominiums_admins/$(condominiumId)/admins/$(request.auth.uid));
    }

    match /condominiums/{condominiumId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/units/{unitId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/financial_transactions/{transactionId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/accounts_receivable/{accountReceivableId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/accounts_payable/{accountPayableId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/suppliers/{supplierId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/employees/{employeeId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/communications/{communicationId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }

    match /condominiums/{condominiumId}/incidents/{incidentId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow update: if isSignedIn() && isCondominiumAdmin(condominiumId);
      allow delete: if isSignedIn() && isCondominiumAdmin(condominiumId);
    }
  }
}