rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdminForCondominium(condominiumId) {
        return exists(/databases/$(database)/documents/condominiums/$(condominiumId)/admins/$(request.auth.uid));
    }

    /**
     * @description Controls access to condominium documents. Only condominium admins can read/write.
     * @path /condominiums/{condominiumId}
     * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
     * @allow (get, list) if isAdminForCondominium(condominiumId)
     * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
     * @deny (get, list) if !isAdminForCondominium(condominiumId)
     * @principle Enforces role-based access control for condominium data.
     */
    match /condominiums/{condominiumId} {
      allow get, list: if isAdminForCondominium(condominiumId);
      allow create, update, delete: if isAdminForCondominium(condominiumId);

      /**
       * @description Controls access to unit documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/units/{unitId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for unit data within a condominium.
       */
      match /units/{unitId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to financial transaction documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/financial_transactions/{transactionId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for financial transaction data.
       */
      match /financial_transactions/{transactionId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to accounts receivable documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/accounts_receivable/{accountReceivableId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for accounts receivable data.
       */
      match /accounts_receivable/{accountReceivableId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to accounts payable documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/accounts_payable/{accountPayableId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for accounts payable data.
       */
      match /accounts_payable/{accountPayableId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to supplier documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/suppliers/{supplierId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for supplier data.
       */
      match /suppliers/{supplierId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to employee documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/employees/{employeeId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for employee data.
       */
      match /employees/{employeeId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to communication documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/communications/{communicationId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for communication data.
       */
      match /communications/{communicationId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }

      /**
       * @description Controls access to incident documents within a condominium. Only condominium admins can read/write.
       * @path /condominiums/{condominiumId}/incidents/{incidentId}
       * @allow (create, update, delete) if isAdminForCondominium(condominiumId)
       * @allow (get, list) if isAdminForCondominium(condominiumId)
       * @deny (create, update, delete) if !isAdminForCondominium(condominiumId)
       * @deny (get, list) if !isAdminForCondominium(condominiumId)
       * @principle Enforces role-based access control for incident data.
       */
      match /incidents/{incidentId} {
        allow get, list: if isAdminForCondominium(condominiumId);
        allow create, update, delete: if isAdminForCondominium(condominiumId);
      }
    }

    // Placeholder for collections not explicitly defined in the structure.
    match /{path=**} {
      allow read, write: if false;
    }
  }
}